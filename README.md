# org.market.biznet

### Описание участников

1. Участник класса **Bank** представляет собой регулятора - Банк
2. Участник класса **Trader** представляет собой юридическое лицо (далее - ЮЛ).

Любое ЮЛ может выступать как покупателем, так и продавцом.

### Описание активов

1. Актив класса **Good** - товар. Характеризуется идентификатором, названием, стоимостью, владельцем и состоянием.
Чтобы выставить товар на продажу, необходимо перевести его в состояние **IN_STOCK**. При этом товар становится видимым для остальных ЮЛ.
2. Актив класса **Account** - это банковский счет. Характеризуется номером *IBAN*, владельцем и балансом счета. У одного ЮЛ может быть любое количество счетов.
3. Актив класса **SalesAgreement** - заказ, соглашение о покупке товара. Характеризуется идентификатором, товаром, покупателем, продавцом и их счетами, а также состоянием.

### Описание транзакций

1. ЮЛ, желающее приобрести нужный товар, вызывает транзакцию **PlaceOrder**, указав при этом счет для списания.
В результате выполнения транзакции товар переходит в состояние **ON_HOLD**, и создается соглашение (актив типа **SalesAgreement**), которое содержит информацию о покупаемом товаре, продавце, покупателе и его счете. Начальный статус соглашения - **WAITING_ACCEPT**.

2. Далее продавец подтверждает заказ, вызвав транзакцию **AcceptOrder**, и указывает при этом счет для зачисления средств. Соглашение переходит в состояние **WAITING_VALIDATE** и ожидает одобрения со стороны банка.

3. Банк, выбрав соглашение, ожидающее валидации, вызывает транзакцию **ValidateOrder**. При этом
   - если у покупателя достаточно средств на счете, то:
     - происходит списание суммы, равной стоимости товара, со счета покупателя и ее зачисление на счет продавца;
     - владелец товара меняется на покупателя;
     - товар переходит а состояние по умолчанию - **IN_PROPERTY**;
     - статус соглашения становится **VALID**.
   - если у покупателя недостаточно средств на счете, то:
     - соглашение переходит в состояние **INVALID**;
     - товар возвращается в состояние **IN_STOCK**.

### Описание ACL-схемы
    C - создание, R - чтение, U - обновление, D - удаление

1. Доступность участников

    Участник | Действие | Участник | Условие
    -------- | -------- | -------- | -------
    Банк | U | Банк | сам
    Банк | R | Банк | другие
    Банк | R | ЮЛ
    ЮЛ | U | ЮЛ | сам
    ЮЛ | R | ЮЛ | другие

2. Доступность активов

    Участник | Действие | Актив | Условие
    -------- | -------- | -------- | -------
    Банк | R | аккаунт | все
    ЮЛ | R | аккаунт | свой
    Банк | R | товар | статус ON_HOLD
    ЮЛ | UD | товар | свои, кроме в статусе ON_HOLD
    ЮЛ | R | товар | свои
    ЮЛ | R | товар | другие, в статусе IN_STOCK
    Банк | R | соглашение
    ЮЛ | R | соглашение | где он покупатель либо продавец

3. Доступность активов через транзакции

    Участник | Действие | Актив | Транзакция
    -------- | -------- | ----- | ----------
    ЮЛ | U | товар | PlaceOrder
    ЮЛ | C | соглашение | PlaceOrder
    ЮЛ | U | соглашение | AcceptOrder
    Банк | U | товар | ValidateOrder
    Банк | U | аккаунт | ValidateOrder
    Банк | U | соглашение | ValidateOrder

4. Доступность транзакций

    Участник | Действие | Транзакция
    -------- | -------- | ----------
    ЮЛ | C | PlaceOrder
    ЮЛ | C | AcceptOrder
    Банк | C | ValidateOrder


### Примечания:

Для "заселения" бизнес-сети первичными данными - участниками и активами - администратору сети необходимо вызвать служебную транзакцию **SetupDemo**.
Это можно сделать вызвав скрипт *init.sh* в папке проекта.
Так же скрипт создаст и импортирует в сеть карточки, соответствующие участниками Bank, Trader1 и Trader2.

#### Тесты ожидаются..
